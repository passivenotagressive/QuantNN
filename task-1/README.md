# Задача 1

Формулировка задачи
------------

Задача была переформулирована в условиях [портфельной теории Марковица](https://ru.wikipedia.org/wiki/%D0%9F%D0%BE%D1%80%D1%82%D1%84%D0%B5%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D1%82%D0%B5%D0%BE%D1%80%D0%B8%D1%8F_%D0%9C%D0%B0%D1%80%D0%BA%D0%BE%D0%B2%D0%B8%D1%86%D0%B0)

Тогда оптимизируемый вектор $x$ - вектор долей акций в портфеле. Отсюда накладывается условие 

$$\sum\limits_{i = 1}^n x_i = 1 \Leftrightarrow e^T x- 1 = 0$$

где $e = (1, 1 ... 1)^T$

В условиях этой теории по входным данным считается матрица ковариаций $Q$ и средний доход $r$. Тогда условие, ограничивающее риск записывается так:

$$x^T Q x \leqslant 0.2^2$$

И весь гамильтониан будем иметь вид

$$x^T H x = - \alpha r^T x + \beta (x^T Q x - 0.04)^2 + \gamma (e^T x - 1)^2$$

Но тогда это перестает быть формой QUBO, поэтому риск будем просто минимизировать:

$$x^T H x^T = -\alpha r^Tx + \beta x^T Q x + \gamma x^T e e^T x - 2\gamma e^T x$$

где $\alpha, \beta, \gamma$ - некоторые веса

Так как вектора весов являются вещественными, их надо предварительно бинаризовать, сделать это можно следуюшим образом.

Введем вектор $b = \left(\frac{1}{2}, \frac{1}{4} ... \frac{1}{2^n} \right)$ и матрицу $B = b b^T$. Тогда матрицы для бинаризованых строк будут иметь вид

Для матриц: $Q' = Q \otimes B$

Для векторов: $r' = r \otimes b$

Тогда можно записать гамильтониан в форме QUBO:

$$H = (\beta Q + \gamma e e^T) \otimes B - (\alpha r + \gamma 2e) \otimes b$$


Результаты
------------
Для параметров $\alpha = 1$, $\beta = 0.1$ и $\gamma = 0.01$ получаются риск $0.18$ и средней за период доходностью $1,68$% с портфелем

```
[49804, 0, 0, 0, 0, 0, 0, 0, 0, 26367, 0, 0, 0, 499023, 249023, 55664, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 12695, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 11718, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
```
